<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Pro Design</title>
  <style>
    body{font-family:Arial;background:#f5f6fa;margin:0}
    .wrap{max-width:980px;margin:20px auto;padding:12px}
    .card{background:#fff;border-radius:18px;padding:16px;margin-bottom:14px;box-shadow:0 6px 22px rgba(0,0,0,.08)}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{padding:12px 14px;border:0;border-radius:14px;font-weight:900;cursor:pointer}
    .blue{background:#1f6feb;color:#fff}
    .red{background:#e74c3c;color:#fff}
    .black{background:#111;color:#fff}
    .order{background:#fafafa;border:1px solid #eee;border-radius:16px;padding:14px;margin-top:12px}
    img{max-width:100%;border-radius:14px;border:1px solid #eee}
    table{width:100%;border-collapse:collapse;margin-top:8px;background:#fff;border-radius:14px;overflow:hidden}
    th,td{border:1px solid #eee;padding:10px;text-align:center}
    a{color:#1f6feb}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2 style="margin:0">ğŸ­ Pro Design - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
    <div class="row">
      <button class="blue" onclick="loadOrders()">ØªØ­Ø¯ÙŠØ« ğŸ”„</button>
      <button class="red" onclick="clearAll()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ ğŸ—‘ï¸</button>
    </div>
    <div style="margin-top:8px;color:#777">ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…ØµÙ†Ø¹: 96765547 | Ø§Ù„Ù…ØµÙ…Ù…: 94016181</div>
  </div>

  <div id="orders"></div>
</div>

<script>
const FACTORY = "96765547";
const DESIGNER = "94016181";

function wa(number, text){
  window.open("https://wa.me/" + number + "?text=" + encodeURIComponent(text), "_blank");
}

function loadOrders(){
  fetch("/api/orders").then(r=>r.json()).then(j=>{
    const box = document.getElementById("orders");
    box.innerHTML = "";

    if(!j.orders.length){
      box.innerHTML = `<div class="card">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>`;
      return;
    }

    j.orders.forEach(o=>{
      const sheets = o.sheets || [];
      const sheetTable = `
        <table>
          <thead><tr><th>Ø§Ù„Ù‚ÙŠØ§Ø³</th><th>Ø§Ù„Ø³Ù…Ø§ÙƒØ©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th></tr></thead>
          <tbody>
            ${sheets.map(s=>`<tr><td>${s.size}</td><td>${s.thickness}</td><td>${s.qty}</td></tr>`).join("")}
          </tbody>
        </table>
      `;

      const pdfInvoice = location.origin + "/api/orders/" + o.id + "/invoice.pdf";
      const pdfSheet   = location.origin + "/api/orders/" + o.id + "/sheet.pdf";

      const msgPDF = `ğŸ“„ Pro Design
Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${o.id}

ğŸ§¾ ÙØ§ØªÙˆØ±Ø© PDF:
${pdfInvoice}

ğŸ“¦ Ø·Ù„Ø¨ Ø´ÙŠØª PDF:
${pdfSheet}`;

      const div = document.createElement("div");
      div.className="card order";
      div.innerHTML = `
        <div><b>#${o.id}</b> - ${new Date(o.createdAt).toLocaleString()}</div>
        <div><b>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${o.customerName || "-"}</div>
        <div><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> ${o.phone || "-"}</div>
        <div><b>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:</b> ${o.jobType || "-"}</div>
        <div><b>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©:</b> ${o.materialType || "-"}</div>
        <div><b>Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø¨Ø§Ø¨:</b> ${o.doorOpenDirection || "-"}</div>
        <div><b>Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·:</b> ${o.lineWidth || "-"}</div>

        <div style="margin-top:8px"><b>Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø·Ù„Ø¨:</b>
          <pre style="white-space:pre-wrap;margin:6px 0">${o.orderMeasurements || "-"}</pre>
        </div>

        <div style="margin-top:8px"><b>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙŠØªØ§Øª:</b>${sheetTable}</div>

        <div style="margin-top:10px"><b>Ù…Ø®Ø·Ø· Ø§Ù„Ø¨Ø§Ø¨ (Ø±Ø³Ù…):</b><br>
          ${o.doorSketch ? `<img src="${o.doorSketch}">` : "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}
        </div>

        <div style="margin-top:10px"><b>Ù…Ù„Ù Ù…Ø±ÙÙ‚:</b>
          ${o.file ? `<a target="_blank" href="${o.file.url}">${o.file.originalname}</a>` : "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}
          ${o.file && (o.file.url.endsWith(".jpg")||o.file.url.endsWith(".png")||o.file.url.endsWith(".jpeg")) ? `<div style="margin-top:8px"><img src="${o.file.url}"></div>` : ""}
        </div>

        <div class="row" style="margin-top:12px">
          <button class="black" onclick="window.open('/api/orders/${o.id}/invoice.pdf','_blank')">ÙØ§ØªÙˆØ±Ø© PDF ğŸ§¾</button>
          <button class="black" onclick="window.open('/api/orders/${o.id}/sheet.pdf','_blank')">Ø·Ù„Ø¨ Ø´ÙŠØª PDF ğŸ“¦</button>
          <button style="background:#16a34a;color:#fff" onclick="wa(FACTORY, msgPDF)">ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…ØµÙ†Ø¹ ğŸ“±</button>
          <button style="background:#7c3aed;color:#fff" onclick="wa(DESIGNER, msgPDF)">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù…ØµÙ…Ù… ğŸ¨</button>
          <button class="red" onclick="delOne('${o.id}')">Ø­Ø°Ù</button>
        </div>
      `;
      box.appendChild(div);
    });
  });
}

function clearAll(){
  if(!confirm("Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ")) return;
  fetch("/api/orders", {method:"DELETE"}).then(loadOrders);
}
function delOne(id){
  if(!confirm("Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ")) return;
  fetch("/api/orders/"+id, {method:"DELETE"}).then(loadOrders);
}

loadOrders();
</script>
</body>
</html>
