<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pro Design CNC - تسجيل الدخول</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!-- Topbar -->
  <div class="topbar">
    <div class="container">
      <div class="brand">
        <div class="logo"></div>
        <div style="min-width:0">
          <h1>Pro Design CNC</h1>
          <p>نظام واحد يرتّب لك الورشة ويختصر وقتك</p>
        </div>
      </div>
    </div>
  </div>

  <div class="container">

    <div class="card" style="margin-top:14px;">
      <div class="card-title">
        <h2 style="font-size:28px;margin:0;">تسجيل الدخول</h2>
      </div>

      <p class="help" style="font-size:14px;margin-top:0;">
        ادخل بياناتك للدخول إلى بوابة العميل أو الأدمن
      </p>

      <label>اسم المستخدم</label>
      <input id="username" placeholder="مثال: client1 أو admin" autocomplete="username"/>

      <label>كلمة المرور</label>
      <input id="password" type="password" placeholder="••••••••" autocomplete="current-password"/>

      <div style="margin-top:14px;">
        <button class="btn btn-ghost" id="loginBtn">دخول</button>
      </div>

      <div class="hr"></div>

      <div class="help" style="font-size:14px;line-height:1.9">
        <div><b>عميل تجريبي:</b> client1 / 1234</div>
        <div><b>أدمن:</b> admin / admin123</div>
      </div>
    </div>

  </div>

<script>
/* =========================
   Pro Design CNC - Login
   Fix redirect issue (client -> admin)
========================= */

const LS = {
  SESSION:"pd_session"
};

function loadSession(){
  try{
    return JSON.parse(localStorage.getItem(LS.SESSION) || "null");
  }catch(e){
    return null;
  }
}

function saveSession(obj){
  localStorage.setItem(LS.SESSION, JSON.stringify(obj));
}

function goByRole(session){
  if(!session) return;

  // ✅ هنا التصحيح: كل رول له صفحة
  if(session.role === "admin"){
    window.location.href = "admin.html";
    return;
  }

  if(session.role === "client"){
    window.location.href = "client.html";
    return;
  }

  // أي شيء ثاني يرجع للدخول
  localStorage.removeItem(LS.SESSION);
  window.location.href = "index.html";
}

// ✅ لو المستخدم مسجل دخول وفتح الرابط يرجعه لنفس صفحته مباشرة
const currentSession = loadSession();
if(currentSession && currentSession.role){
  goByRole(currentSession);
}

// Login button
document.getElementById("loginBtn").addEventListener("click", ()=>{
  const u = (document.getElementById("username").value || "").trim();
  const p = (document.getElementById("password").value || "").trim();

  // Admin
  if(u === "admin" && p === "admin123"){
    saveSession({
      role:"admin",
      username:"admin",
      company:"Pro Design Admin",
      loginAt: new Date().toISOString()
    });
    goByRole(loadSession());
    return;
  }

  // Client demo
  if(u === "client1" && p === "1234"){
    saveSession({
      role:"client",
      username:"client1",
      company:"شركة العميل 1",
      loginAt: new Date().toISOString()
    });
    goByRole(loadSession());
    return;
  }

  alert("❌ بيانات الدخول غير صحيحة");
});

// Enter key
document.addEventListener("keydown",(e)=>{
  if(e.key === "Enter"){
    document.getElementById("loginBtn").click();
  }
});
</script>

</body>
</html>
