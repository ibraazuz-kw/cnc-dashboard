<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ - CNC</title>

  <!-- Ù…ÙƒØªØ¨Ø© PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body{font-family:Tahoma,Arial;background:#f5f6fa;margin:0}
    .header{background:#0b5;color:#fff;padding:16px;text-align:center;font-size:20px;font-weight:900}
    .wrap{max-width:980px;margin:18px auto;padding:12px}
    .card{background:#fff;border-radius:14px;padding:16px;box-shadow:0 8px 20px rgba(0,0,0,.07);margin-bottom:14px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .col{flex:1;min-width:220px}
    label{display:block;margin:10px 0 6px;font-weight:800}
    input,select,textarea{width:100%;padding:11px;border:1px solid #ddd;border-radius:10px;font-size:15px}
    textarea{min-height:80px}
    .btn{padding:12px 14px;border:none;border-radius:12px;font-weight:900;cursor:pointer;font-size:16px}
    .btn-green{background:#0b7;color:#fff}
    .btn-blue{background:#1677ff;color:#fff}
    .btn-gray{background:#555;color:#fff}
    .btn-red{background:#e33;color:#fff}
    .mini{padding:8px 10px;font-size:14px;border-radius:10px}
    .title{font-size:18px;font-weight:900;margin-bottom:6px}
    .sub{color:#666;font-size:13px;margin-top:2px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #ddd;padding:10px;text-align:center}
    th{background:#f1f1f1}
    .plus{display:flex;justify-content:flex-end;margin-top:10px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .company{font-weight:900;font-size:16px}
    .logout{background:#111;color:#fff}
    .note{font-size:13px;color:#777;margin-top:8px}
    .divider{height:1px;background:#eee;margin:14px 0}
  </style>
</head>

<body>
  <div class="header">ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ CNC)</div>

  <div class="wrap">

    <div class="card">
      <div class="topbar">
        <div class="company" id="companyName">...</div>
        <button class="btn logout mini" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
      </div>
      <div class="sub">Ù‡Ø°Ù‡ ØµÙØ­Ø© Ø®Ø§ØµØ© Ù„Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
    </div>

    <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙŠØª -->
    <div class="card">
      <div class="title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙŠØª (Ù„Ù„Ø´Ø±Ø§Ø¡)</div>
      <div class="sub">Ø§ÙƒØªØ¨ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø´ÙŠØª + Ø§Ù„Ø³Ù…Ø§ÙƒØ© + Ø§Ù„ÙƒÙ…ÙŠØ©ØŒ ÙˆØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ Ø£ÙƒØ«Ø± Ù…Ù† Ø´ÙŠØª</div>

      <div id="sheetsArea"></div>

      <div class="plus">
        <button class="btn btn-blue mini" onclick="addSheetRow()">+ Ø¥Ø¶Ø§ÙØ© Ø´ÙŠØª</button>
      </div>

      <div class="divider"></div>

      <button class="btn btn-green" onclick="sendSupplierWhatsApp()">ğŸ“© Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø´ÙŠØª Ù„Ù„Ù…ÙˆØ±Ø¯ (ÙˆØ§ØªØ³Ø§Ø¨)</button>
      <div class="note">ÙŠØ·Ù„Ø¹ Ù„Ùƒ Ù†Øµ Ø¬Ø§Ù‡Ø² Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠÙ‡ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ + ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙŠØª ÙÙ‚Ø·.</div>
    </div>

    <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
    <div class="card">
      <div class="title">ØªÙØ§ØµÙŠÙ„ Ù‚Øµ / Ø­ÙØ± CNC</div>

      <div class="row">
        <div class="col">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
          <select id="material">
            <option>Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
            <option>Ø³ØªØ§Ù†Ù„Ø³</option>
            <option>Ø­Ø¯ÙŠØ¯</option>
            <option>Ø£Ù„ÙÙƒÙˆØ¨ÙˆÙ†Ø¯</option>
          </select>
        </div>

        <div class="col">
          <label>Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø· / Ø§Ù„Ø³Ù…Ø§ÙƒØ© (mm)</label>
          <input id="lineWidth" placeholder="Ù…Ø«Ø§Ù„: 10" />
        </div>
      </div>

      <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Øµ / Ø§Ù„Ø­ÙØ±</label>
      <textarea id="cutDetails" placeholder="Ù…Ø«Ø§Ù„: Ù‚Øµ Ø®Ø§Ø±Ø¬ÙŠ + Ø­ÙØ± Ø´Ø¹Ø§Ø± + ÙØªØ­Ø§Øª Ù…Ø³ÙƒØ© Ù…Ø®ÙÙŠØ© ..."></textarea>

      <label>Ø±ÙØ¹ Ù…Ù„Ù (DXF / PDF / ØµÙˆØ±Ø©)</label>
      <input id="fileUpload" type="file" />

      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
      <textarea id="notes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª..."></textarea>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª (Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø©) -->
    <div class="card">
      <div class="title">Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù‚Øµ (Ø¨Ø§Ù„Ø³Ù†ØªÙŠÙ…ØªØ± CM) Ù…Ø«Ù„ Ø£Ù…Ø± Ø§Ù„Ø´ØºÙ„</div>
      <div class="sub">Ø§ÙƒØªØ¨ Ø¹Ø±Ø¶ + Ø§Ø±ØªÙØ§Ø¹ + Ø§Ù„Ø¹Ø¯Ø¯ØŒ ÙˆØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ Ø³Ø·ÙˆØ± ÙƒØ«ÙŠØ±Ø©</div>

      <table>
        <thead>
          <tr>
            <th>Ù…</th>
            <th>Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)</th>
            <th>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ø³Ù…)</th>
            <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
            <th>Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody id="sizesTable"></tbody>
      </table>

      <div class="plus">
        <button class="btn btn-blue mini" onclick="addSizeRow()">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø±</button>
      </div>

      <div class="divider"></div>

      <button class="btn btn-green" onclick="generatePDF()">ğŸ“„ ØªØ­Ù…ÙŠÙ„ PDF Ø£Ù…Ø± Ø´ØºÙ„</button>
      <div class="note">PDF ÙŠØ·Ù„Ø¹ Ù…Ø±ØªØ¨ Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø©: Ø¹Ù†ÙˆØ§Ù† + Ø¬Ø¯ÙˆÙ„ Ù…Ù‚Ø§Ø³Ø§Øª + Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ØªØµÙ…ÙŠÙ….</div>
    </div>

    <div class="card">
      <button class="btn btn-gray" onclick="goHome()">Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø¨ÙˆØ§Ø¨Ø©</button>
    </div>

  </div>

<script>
  // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø© (Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„)
  const client = JSON.parse(localStorage.getItem("loggedClient") || "null");
  if(!client){
    window.location.href = "index.html";
  }

  document.getElementById("companyName").innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹: " + client.company;

  // ====== Ø§Ù„Ø´ÙŠØªØ§Øª ======
  function addSheetRow(){
    const area = document.getElementById("sheetsArea");

    const div = document.createElement("div");
    div.className = "row";
    div.style.marginTop = "10px";

    div.innerHTML = `
      <div class="col">
        <label>Ù‚ÙŠØ§Ø³ Ø§Ù„Ø´ÙŠØª (Ù…Ø«Ø§Ù„ 122Ã—244)</label>
        <input class="sheetSize" placeholder="122Ã—244" />
      </div>
      <div class="col">
        <label>Ø§Ù„Ø³Ù…Ø§ÙƒØ© (mm)</label>
        <input class="sheetThick" placeholder="Ù…Ø«Ø§Ù„: 3" />
      </div>
      <div class="col">
        <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
        <input class="sheetQty" placeholder="Ù…Ø«Ø§Ù„: 5" />
      </div>
      <div class="col" style="min-width:120px">
        <label>Ø­Ø°Ù</label>
        <button class="btn btn-red mini" onclick="this.parentElement.parentElement.remove()">Ø­Ø°Ù</button>
      </div>
    `;

    area.appendChild(div);
  }

  // Ø£ÙˆÙ„ Ø´ÙŠØª Ø§ÙØªØ±Ø§Ø¶ÙŠ
  addSheetRow();

  function getSheets(){
    const sizes = [...document.querySelectorAll(".sheetSize")].map(i => i.value.trim());
    const thicks = [...document.querySelectorAll(".sheetThick")].map(i => i.value.trim());
    const qtys = [...document.querySelectorAll(".sheetQty")].map(i => i.value.trim());

    let arr = [];
    for(let i=0;i<sizes.length;i++){
      if(sizes[i] || thicks[i] || qtys[i]){
        arr.push({
          size: sizes[i] || "-",
          thick: thicks[i] || "-",
          qty: qtys[i] || "-"
        });
      }
    }
    return arr;
  }

  function sendSupplierWhatsApp(){
    const sheets = getSheets();
    if(sheets.length === 0){
      alert("Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙŠØª Ø£ÙˆÙ„Ø§Ù‹");
      return;
    }

    let msg = `Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø´ÙŠØªØ§Øª\n`;
    msg += `Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.company}\n\n`;
    msg += `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙŠØª:\n`;

    sheets.forEach((s, idx) => {
      msg += `${idx+1}) Ù‚ÙŠØ§Ø³: ${s.size} | Ø³Ù…Ø§ÙƒØ©: ${s.thick}mm | ÙƒÙ…ÙŠØ©: ${s.qty}\n`;
    });

    msg += `\nØ´ÙƒØ±Ø§Ù‹`;

    // Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ (ØºÙŠØ±Ù‡ Ø¨Ø±Ø§Ø­ØªÙƒ)
    const supplierNumber = "96500000000"; // <-- Ø­Ø· Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ Ù‡Ù†Ø§
    const url = `https://wa.me/${supplierNumber}?text=${encodeURIComponent(msg)}`;
    window.open(url, "_blank");
  }

  // ====== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª ======
  let counter = 0;

  function addSizeRow(){
    counter++;
    const tbody = document.getElementById("sizesTable");
    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${counter}</td>
      <td><input class="w" placeholder="Ù…Ø«Ø§Ù„: 80.8" style="width:110px"/></td>
      <td><input class="h" placeholder="Ù…Ø«Ø§Ù„: 196.5" style="width:110px"/></td>
      <td><input class="q" placeholder="1" style="width:70px"/></td>
      <td><button class="btn btn-red mini" onclick="this.parentElement.parentElement.remove()">Ø­Ø°Ù</button></td>
    `;
    tbody.appendChild(tr);
  }

  // Ø£ÙˆÙ„ Ø³Ø·Ø±ÙŠÙ†
  addSizeRow();
  addSizeRow();

  function getSizes(){
    const rows = [...document.querySelectorAll("#sizesTable tr")];
    let data = [];
    rows.forEach((r, i) => {
      const w = r.querySelector(".w").value.trim();
      const h = r.querySelector(".h").value.trim();
      const q = r.querySelector(".q").value.trim();
      if(w || h || q){
        data.push({ no: i+1, w: w || "-", h: h || "-", q: q || "-" });
      }
    });
    return data;
  }

  // ====== PDF Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø© ======
  async function generatePDF(){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF("p", "mm", "a4");

    const today = new Date();
    const dateText = `${today.getDate()}/${today.getMonth()+1}/${today.getFullYear()}`;

    const material = document.getElementById("material").value;
    const lineWidth = document.getElementById("lineWidth").value.trim() || "-";
    const cutDetails = document.getElementById("cutDetails").value.trim() || "-";

    const sizes = getSizes();

    // Ø¹Ù†ÙˆØ§Ù†
    doc.setFont("Helvetica","bold");
    doc.setFontSize(16);
    doc.text("Ø£Ù…Ø± Ø´ØºÙ„ CNC", 105, 18, { align:"center" });

    doc.setFontSize(11);
    doc.setFont("Helvetica","normal");
    doc.text(`Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: ${client.company}`, 15, 30);
    doc.text(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateText}`, 15, 38);

    doc.setFont("Helvetica","bold");
    doc.text(`Ø·Ù„Ø¨ Ù‚Øµ ÙˆØ­ÙØ± CNC - ${material} - Ø¹Ø±Ø¶ Ø®Ø·/Ø³Ù…Ø§ÙƒØ©: ${lineWidth}mm`, 15, 48);

    doc.setFont("Helvetica","normal");
    doc.text(`ØªÙØ§ØµÙŠÙ„: ${cutDetails}`, 15, 56);

    // Ø¬Ø¯ÙˆÙ„
    let startY = 70;

    doc.setFont("Helvetica","bold");
    doc.text("Ù…", 190, startY, { align:"right" });
    doc.text("Ø§Ù„Ø¹Ø±Ø¶ (Ø³Ù…)", 150, startY, { align:"right" });
    doc.text("Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Ø³Ù…)", 95, startY, { align:"right" });
    doc.text("Ø§Ù„Ø¹Ø¯Ø¯", 40, startY, { align:"right" });

    doc.setLineWidth(0.3);
    doc.line(15, startY+2, 195, startY+2);

    doc.setFont("Helvetica","normal");
    let y = startY + 10;

    sizes.forEach((s) => {
      doc.text(String(s.no), 190, y, { align:"right" });
      doc.text(String(s.w), 150, y, { align:"right" });
      doc.text(String(s.h), 95, y, { align:"right" });
      doc.text(String(s.q), 40, y, { align:"right" });
      doc.line(15, y+2, 195, y+2);
      y += 10;
    });

    // Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ±Ø©
    y += 10;
    doc.setFont("Helvetica","bold");
    doc.text("ÙŠØ±Ø¬Ù‰ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø´ÙƒÙ„ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø±ÙÙ‚ Ù„ÙƒÙ… Ø³Ø§Ø¨Ù‚Ø§Ù‹", 105, y, { align:"center" });

    doc.save("CNC-Order.pdf");
  }

  // ====== ØªÙ†Ù‚Ù„ ======
  function logout(){
    localStorage.removeItem("loggedClient");
    window.location.href = "index.html";
  }

  function goHome(){
    window.location.href = "index.html";
  }
</script>
</body>
</html>
