<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
  <style>
    body{font-family:Arial;background:#f5f5f5;margin:0}
    header{background:#111;color:#fff;padding:16px}
    .wrap{max-width:980px;margin:18px auto;padding:0 12px}
    .card{background:#fff;border-radius:14px;padding:14px;box-shadow:0 10px 25px rgba(0,0,0,.06);margin-bottom:12px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:700px){.row{grid-template-columns:1fr}}
    label{display:block;margin:10px 0 6px;font-weight:bold}
    input,select,textarea{width:100%;padding:12px;border:1px solid #ddd;border-radius:12px;font-size:15px;box-sizing:border-box}
    textarea{min-height:90px;resize:vertical}
    .secHead{display:flex;justify-content:space-between;align-items:center;cursor:pointer}
    .plus{font-weight:bold;font-size:20px;background:#f1f2f6;border-radius:10px;padding:6px 10px}
    .hidden{display:none}
    .btn{padding:14px;border:0;border-radius:12px;font-size:16px;font-weight:bold;cursor:pointer}
    .send{background:#198754;color:#fff;width:100%}
    .out{background:#6c757d;color:#fff;width:100%;margin-top:8px}
    .ok{display:none;margin-top:10px;background:#e8f5e9;border:1px solid #a5d6a7;color:#1b5e20;padding:10px;border-radius:12px;text-align:center;font-weight:bold}

    .tag{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      font-size:13px;
      font-weight:bold;
    }
    .st-new{background:#e3f2fd;color:#0d47a1}
    .st-run{background:#fff3cd;color:#7a5b00}
    .st-done{background:#e8f5e9;color:#1b5e20}
    .check{font-size:18px;margin-right:6px}
    .orderBox{border:1px solid #eee;border-radius:12px;padding:12px;background:#fafafa;margin-top:10px}
    .small{color:#555;font-size:14px;margin:3px 0}
    .pdfBtn{
      display:inline-block;
      margin-top:8px;
      background:#0d6efd;
      color:#fff;
      padding:10px 12px;
      border-radius:10px;
      text-decoration:none;
      font-weight:bold;
    }
  </style>
</head>
<body>

<header>
  <div class="wrap">
    <div style="font-size:18px;font-weight:bold">Pro Design | ØµÙØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</div>
    <div id="company" style="opacity:.85;margin-top:6px"></div>
  </div>
</header>

<div class="wrap">

  <div class="card">
    <div class="secHead" onclick="toggle('track')">
      <div><b>ğŸ“¦ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</b></div>
      <div class="plus">+</div>
    </div>
    <div id="track" class="hidden">
      <div id="ordersArea" class="small">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>
  </div>

  <div class="card">
    <div class="secHead" onclick="toggle('s1')">
      <div><b>ğŸ“Œ Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</b></div>
      <div class="plus">+</div>
    </div>
    <div id="s1" class="hidden">
      <label>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</label>
      <select id="orderType">
        <option>Ù‚Øµ CNC</option>
        <option>ØªÙØ±ÙŠØ² CNC</option>
        <option>Ø­ÙØ± / Ù†Ù‚Ø´</option>
        <option>Ù‚Øµ Ù„ÙŠØ²Ø±</option>
        <option>Ø£Ø¨ÙˆØ§Ø¨ Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
        <option>Ø´Ø¨Ø§Ø¨ÙŠÙƒ Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
        <option>Ø£Ø®Ø±Ù‰</option>
      </select>
    </div>
  </div>

  <div class="card">
    <div class="secHead" onclick="toggle('s2')">
      <div><b>ğŸ“ Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø´ÙŠØª</b></div>
      <div class="plus">+</div>
    </div>
    <div id="s2" class="hidden">
      <div class="row">
        <div>
          <label>Ù…Ù‚Ø§Ø³ Ø§Ù„Ø´ÙŠØª</label>
          <select id="sheetSize">
            <option value="122x244">122Ã—244</option>
            <option value="122x300">122Ã—300</option>
            <option value="150x300">150Ã—300</option>
            <option value="122x350">122Ã—350</option>
            <option value="122x400">122Ã—400</option>
            <option value="150x400">150Ã—400</option>
            <option value="custom">Ù…Ù‚Ø§Ø³ Ø®Ø§Øµ</option>
          </select>
        </div>
        <div>
          <label>Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø´ÙŠØª (mm)</label>
          <select id="sheetThk">
            <option>2</option><option>3</option><option>4</option><option>5</option>
            <option>6</option><option>8</option><option>10</option><option>12</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
          <select id="material">
            <option>Ø£Ù„Ù…Ù†ÙŠÙˆÙ…</option>
            <option>Ø£Ù„ÙƒÙˆØ¨ÙˆÙ†Ø¯</option>
            <option>Ø£ÙƒØ±ÙŠÙ„Ùƒ</option>
            <option>Ø­Ø¯ÙŠØ¯</option>
            <option>Ø³ØªØ§Ù†Ù„Ø³</option>
          </select>
        </div>
        <div>
          <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙŠØªØ§Øª</label>
          <input id="sheetQty" type="number" value="1" min="1"/>
        </div>
      </div>

      <label>Ù…Ù‚Ø§Ø³ Ø®Ø§Øµ (Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª Ù…Ù‚Ø§Ø³ Ø®Ø§Øµ)</label>
      <input id="customSize" placeholder="Ù…Ø«Ø§Ù„: 100Ã—200" />
    </div>
  </div>

  <div class="card">
    <div class="secHead" onclick="toggle('s3')">
      <div><b>ğŸ›  ØªÙØ§ØµÙŠÙ„ Ù‚Øµ / Ø­ÙØ±</b></div>
      <div class="plus">+</div>
    </div>
    <div id="s3" class="hidden">
      <div class="row">
        <div>
          <label>Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø· (mm)</label>
          <select id="lineWidth">
            <option>4</option><option>6</option><option>8</option><option>10</option>
            <option>12</option><option>15</option><option>20</option><option>25</option>
            <option>30</option><option>40</option>
            <option value="other">Ø£Ø®Ø±Ù‰</option>
          </select>
        </div>
        <div>
          <label>Ø¹Ø±Ø¶ Ø®Ø· Ø¢Ø®Ø± (Ø¥Ø°Ø§ Ø£Ø®Ø±Ù‰)</label>
          <input id="lineOther" placeholder="Ù…Ø«Ø§Ù„: 18" />
        </div>
      </div>

      <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Øµ/Ø§Ù„Ø­ÙØ±</label>
      <textarea id="jobDetails" placeholder="Ù…Ø«Ø§Ù„: ÙØªØ­Ø§Øª Ø¬Ø§Ù… / Ù…Ø³ÙƒØ© Ù…Ø®ÙÙŠØ© / Ù…Ø³Ø§Ø± Ø­ÙØ±..."></textarea>
    </div>
  </div>

  <div class="card">
    <div class="secHead" onclick="toggle('s5')">
      <div><b>âœï¸ Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø´ØºÙ„ (ÙŠØ¯ÙˆÙŠ)</b></div>
      <div class="plus">+</div>
    </div>
    <div id="s5" class="hidden">
      <textarea id="manual" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙŠØ¯ÙˆÙŠ..."></textarea>
    </div>
  </div>

  <div class="card">
    <div class="secHead" onclick="toggle('s6')">
      <div><b>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„</b></div>
      <div class="plus">+</div>
    </div>
    <div id="s6" class="hidden">
      <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea id="notes" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>

      <button class="btn send" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
      <button class="btn out" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

      <div id="ok" class="ok">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­</div>
    </div>
  </div>

</div>

<script>
  function toggle(id){
    document.getElementById(id).classList.toggle("hidden");
  }

  function getSession(){
    return JSON.parse(localStorage.getItem("CNC_SESSION") || "null");
  }

  function getOrders(){
    return JSON.parse(localStorage.getItem("CNC_ORDERS") || "[]");
  }

  function saveOrders(data){
    localStorage.setItem("CNC_ORDERS", JSON.stringify(data));
  }

  function logout(){
    localStorage.removeItem("CNC_SESSION");
    location.href = "/login";
  }

  function badge(status){
    if(status === "Ø¬Ø§Ù‡Ø²") return `<span class="tag st-done"><span class="check">âœ…</span>Ø¬Ø§Ù‡Ø²</span>`;
    if(status === "Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„") return `<span class="tag st-run">â³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„</span>`;
    return `<span class="tag st-new">ğŸ†• Ø¬Ø¯ÙŠØ¯</span>`;
  }

  function renderMyOrders(){
    const session = getSession();
    const area = document.getElementById("ordersArea");
    if(!session){
      area.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ø¯Ø®ÙˆÙ„.";
      return;
    }

    const orders = getOrders().filter(o => o.clientId === session.clientId);

    if(orders.length === 0){
      area.innerHTML = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù„Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹.";
      return;
    }

    area.innerHTML = orders.map(o => {
      const pdfBtn = o.designerPdf
        ? `<a class="pdfBtn" href="${o.designerPdf.data}" target="_blank">ğŸ“„ Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø®Ø·Ø· Ø§Ù„Ù…ØµÙ…Ù… (PDF)</a>`
        : `<div class="small">ğŸ“„ Ù…Ø®Ø·Ø· Ø§Ù„Ù…ØµÙ…Ù…: ØºÙŠØ± Ù…ØªÙˆÙØ±</div>`;

      return `
        <div class="orderBox">
          <div><b>Ø·Ù„Ø¨:</b> ${o.orderType} ${badge(o.status || "Ø¬Ø¯ÙŠØ¯")}</div>
          <div class="small">ğŸ•’ ${o.createdAt}</div>
          <div class="small">ğŸ“ Ø´ÙŠØª: ${o.sheet.size} | Ø³Ù…Ø§ÙƒØ©: ${o.sheet.thickness}mm | Ù…Ø§Ø¯Ø©: ${o.sheet.material} | Ø¹Ø¯Ø¯: ${o.sheet.qty}</div>
          ${pdfBtn}
        </div>
      `;
    }).join("");
  }

  const session = getSession();
  if(!session){
    location.href = "/login";
  }else{
    document.getElementById("company").innerText = "Ø§Ù„Ø´Ø±ÙƒØ©: " + session.company + " | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: " + session.username;
    renderMyOrders();
  }

  function sendOrder(){
    const session = getSession();
    if(!session){
      alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¬Ù„Ø³Ø© Ø¯Ø®ÙˆÙ„");
      return;
    }

    const orderType = document.getElementById("orderType").value;
    const sheetSize = document.getElementById("sheetSize").value;
    const customSize = document.getElementById("customSize").value.trim();
    const sheetThk = document.getElementById("sheetThk").value;
    const material = document.getElementById("material").value;
    const sheetQty = document.getElementById("sheetQty").value;

    let lineWidth = document.getElementById("lineWidth").value;
    const lineOther = document.getElementById("lineOther").value.trim();
    if(lineWidth === "other") lineWidth = lineOther || "Ø£Ø®Ø±Ù‰";

    const jobDetails = document.getElementById("jobDetails").value.trim();
    const manual = document.getElementById("manual").value.trim();
    const notes = document.getElementById("notes").value.trim();

    const order = {
      id: "O" + Date.now(),
      clientId: session.clientId,
      company: session.company,
      createdAt: new Date().toLocaleString("ar-KW"),
      status: "Ø¬Ø¯ÙŠØ¯",
      orderType,
      sheet: {
        size: sheetSize === "custom" ? (customSize || "Ù…Ù‚Ø§Ø³ Ø®Ø§Øµ") : sheetSize,
        thickness: sheetThk,
        material,
        qty: sheetQty
      },
      cutting: { lineWidth, jobDetails },
      manual,
      notes,
      designerPdf: null
    };

    const orders = getOrders();
    orders.unshift(order);
    saveOrders(orders);

    document.getElementById("ok").style.display = "block";
    setTimeout(()=> document.getElementById("ok").style.display = "none", 2000);

    renderMyOrders();
  }
</script>

</body>
</html>
